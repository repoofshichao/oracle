## 改变执行计划的其他手段

### 1.set_table_stats
收集统计信息在业务高峰期影响生产，但可以使用set_table_stats的方式来告诉Oracle表的大小情况。
```java
exec dbms_stats.set_table_stats(user,'Table',numrows=>10000,numblks=>20);
```

### 2.固定执行计划
* 构造测试表
```java
drop table t purge;
create table t as select * from dba_objects where object_id is not null;
create index idx_object_id on t(object_id);
set linesize 1000
set pagesize 1000
explain plan for select count(*) from t;
select * from table(dbms_xplan.display());
```

执行计划A如下
```
PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Plan hash value: 2966233522

-------------------------------------------------------------------
| Id  | Operation	   | Name | Rows  | Cost (%CPU)| Time	  |
-------------------------------------------------------------------
|   0 | SELECT STATEMENT   |	  |	1 |   114   (0)| 00:00:01 |
|   1 |  SORT AGGREGATE    |	  |	1 |	       |	  |
|   2 |   TABLE ACCESS FULL| T	  | 22469 |   114   (0)| 00:00:01 |
-------------------------------------------------------------------

```

* 建立大纲
```java

create or replace outline myoutline
for category mycategory
on 
select count(*) from t
/

select category,sql_text,signature from user_outlines where name='MYOUTLINE';

```

* 建立索引，生成执行计划B.
```java
alter table t modify object_id  not null;
explain plan for select count(*) from t;
select * from table(dbms_xplan.display());
```

执行计划B如下
```
PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Plan hash value: 1131838604

-------------------------------------------------------------------------------
| Id  | Operation	      | Name	      | Rows  | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT      | 	      |     1 |    15	(0)| 00:00:01 |
|   1 |  SORT AGGREGATE       | 	      |     1 | 	   |	      |
|   2 |   INDEX FAST FULL SCAN| IDX_OBJECT_ID | 22469 |    15	(0)| 00:00:01 |
-------------------------------------------------------------------------------

```

* 沿用大纲，固定执行计划为A。
```java
alter session set use_stored_outlines =mycategory;
explain plan for select count(*) from t;
select * from table(dbms_xplan.display());
```
执行计划A
```
PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Plan hash value: 2966233522

-------------------------------------------------------------------
| Id  | Operation	   | Name | Rows  | Cost (%CPU)| Time	  |
-------------------------------------------------------------------
|   0 | SELECT STATEMENT   |	  |	1 |   114   (0)| 00:00:01 |
|   1 |  SORT AGGREGATE    |	  |	1 |	       |	  |
|   2 |   TABLE ACCESS FULL| T	  | 22469 |   114   (0)| 00:00:01 |
-------------------------------------------------------------------

Note
-----
   - outline "MYOUTLINE" used for this statement

```