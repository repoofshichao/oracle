## 查询提交过频的语句

### 执行提交过频的sql

```
drop table t purge;
create table t(x int);
select * from v$mystat where rownum=1;
begin
    for i in 1 .. 100000 loop
       insert into t values (i); 

      commit;  

    end loop;
end;
/
```
### 1.获取提交次数超过一个阈值的SID
```
select t1.sid, t1.value, t2.name
  from v$sesstat t1, v$statname t2
 where t2.name like '%user commits%'
   and t1.STATISTIC# = t2.STATISTIC#
   and value >= 10000
 order by value desc;
```
```
       SID	VALUE NAME
---------- ---------- ----------------------------------------------------------------
	 1     100004 user commits

```

### 2.获取到对应的Sql_id
```
select t.SID,
       t.PROGRAM,
       t.EVENT,
       t.LOGON_TIME,
       t.WAIT_TIME,
       t.SECONDS_IN_WAIT,
       t.SQL_ID,
       t.PREV_SQL_ID
  from v$session t
 where sid in(1);
```
```
       SID PROGRAM					    EVENT							     LOGON_TIME    WAIT_TIME SECONDS_IN_WAIT SQL_ID	   PREV_SQL_ID
---------- ------------------------------------------------ ---------------------------------------------------------------- ------------ ---------- --------------- ------------- -------------
	 1 sqlplus@localhost.localdomain (TNS V1-V3)	    SQL*Net message to client					     04-MAR-18		  -1		   0 99wn430v6s55n 3a91t5zg11ggd

```

### 3.通过Sql_id得到对应的SQL
```
select t.sql_id,
       t.sql_text,
       t.EXECUTIONS,
       t.FIRST_LOAD_TIME,
       t.LAST_LOAD_TIME
  from v$sqlarea t
 where sql_id in ('3a91t5zg11ggd');
```
```
SQL_ID
-------------
SQL_TEXT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
EXECUTIONS FIRST_LOAD_TIME			  LAST_LOAD_TI
---------- -------------------------------------- ------------
3a91t5zg11ggd
begin	  for i in 1 .. 100000 loop	   insert into t values (i);	    commit;	 end loop; end;
	 1 2018-03-04/12:04:05			  04-MAR-18

```

* 通过这种方式获取sql有一个限制:session 1提交频繁，在session 2中查找问题时，session 1不能在执行任何sql，否则找不到真正提交频繁的语句。