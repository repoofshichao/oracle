alter session set statistics_level=all;
set linesize 1000
select /*+leading(t1) use_merge(t2)*/ * from t1,t2 where t1.id=t2.t1_id;

select * from table(dbms_xplan.display_cursor(null,null,'allstats last'));

SQL_ID	bx7t6rma4cpv7, child number 0
-------------------------------------
select /*+leading(t1) use_merge(t2)*/ * from t1,t2 where t1.id=t2.t1_id

Plan hash value: 412793182

--------------------------------------------------------------------------------------------------------------------------
| Id  | Operation	    | Name | Starts | E-Rows | A-Rows |   A-Time   | Buffers | Reads  |  OMem |  1Mem | Used-Mem |
--------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT    |	   |	  1 |	     |	  100 |00:00:00.12 |	1012 |	  668 |       |       | 	 |
|   1 |  MERGE JOIN	    |	   |	  1 |	 100 |	  100 |00:00:00.12 |	1012 |	  668 |       |       | 	 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|   2 |   SORT JOIN	    |	   |	  1 |	 100 |	  100 |00:00:00.01 |	   7 |	    0 | 13312 | 13312 |12288  (0)|
|   3 |    TABLE ACCESS FULL| T1   |	  1 |	 100 |	  100 |00:00:00.01 |	   7 |	    0 |       |       | 	 |
|*  4 |   SORT JOIN	    |	   |	100 |  93921 |	  100 |00:00:00.12 |	1005 |	  668 |  9762K|  1209K| 8677K (0)|
|   5 |    TABLE ACCESS FULL| T2   |	  1 |  93921 |	  100K|00:00:00.05 |	1005 |	  668 |       |       | 	 |
--------------------------------------------------------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   4 - access("T1"."ID"="T2"."T1_ID")
       filter("T1"."ID"="T2"."T1_ID")

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Note
-----
   - dynamic statistics used: dynamic sampling (level=2)

连接条件上加索引，可以减少排序步骤。
create index idx_t1_id on t1(id);

select /*+leading(t1) use_merge(t2)*/ * from t1,t2 where t1.id=t2.t1_id;

select * from table(dbms_xplan.display_cursor(null,null,'allstats  last'));

SQL_ID	bx7t6rma4cpv7, child number 0
-------------------------------------
select /*+leading(t1) use_merge(t2)*/ * from t1,t2 where t1.id=t2.t1_id

Plan hash value: 2678642687

-------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation		     | Name	 | Starts | E-Rows | A-Rows |	A-Time	 | Buffers |  OMem |  1Mem | Used-Mem |
-------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT	     |		 |	1 |	   |	100 |00:00:00.10 |    1021 |	   |	   |	      |
|   1 |  MERGE JOIN		     |		 |	1 |    100 |	100 |00:00:00.10 |    1021 |	   |	   |	      |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|   2 |   TABLE ACCESS BY INDEX ROWID| T1	 |	1 |    100 |	100 |00:00:00.01 |	16 |	   |	   |	      |
|   3 |    INDEX FULL SCAN	     | IDX_T1_ID |	1 |    100 |	100 |00:00:00.01 |	 8 |	   |	   |	      |
|*  4 |   SORT JOIN		     |		 |    100 |  93921 |	100 |00:00:00.10 |    1005 |  9762K|  1209K| 8677K (0)|
|   5 |    TABLE ACCESS FULL	     | T2	 |	1 |  93921 |	100K|00:00:00.03 |    1005 |	   |	   |	      |
-------------------------------------------------------------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   4 - access("T1"."ID"="T2"."T1_ID")
       filter("T1"."ID"="T2"."T1_ID")

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Note
-----
   - dynamic statistics used: dynamic sampling (level=2)

表2的连接条件上加索引，并不能减少排序。可能的原因是t2表的记录数比较多，oracle认为用索引可以减少排序，但是带来了回表的副作用。所以未用索引。
create index idx_t2_t1_id on t2(t1_id)


SQL_ID	bx7t6rma4cpv7, child number 0
-------------------------------------
select /*+leading(t1) use_merge(t2)*/ * from t1,t2 where t1.id=t2.t1_id

Plan hash value: 2678642687

-------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation		     | Name	 | Starts | E-Rows | A-Rows |	A-Time	 | Buffers |  OMem |  1Mem | Used-Mem |
-------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT	     |		 |	1 |	   |	100 |00:00:00.10 |    1021 |	   |	   |	      |
|   1 |  MERGE JOIN		     |		 |	1 |    100 |	100 |00:00:00.10 |    1021 |	   |	   |	      |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|   2 |   TABLE ACCESS BY INDEX ROWID| T1	 |	1 |    100 |	100 |00:00:00.01 |	16 |	   |	   |	      |
|   3 |    INDEX FULL SCAN	     | IDX_T1_ID |	1 |    100 |	100 |00:00:00.01 |	 8 |	   |	   |	      |
|*  4 |   SORT JOIN		     |		 |    100 |  93921 |	100 |00:00:00.10 |    1005 |  9762K|  1209K| 8677K (0)|
|   5 |    TABLE ACCESS FULL	     | T2	 |	1 |  93921 |	100K|00:00:00.03 |    1005 |	   |	   |	      |
-------------------------------------------------------------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   4 - access("T1"."ID"="T2"."T1_ID")
       filter("T1"."ID"="T2"."T1_ID")

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Note
-----
   - dynamic statistics used: dynamic sampling (level=2)

